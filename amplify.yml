version: 1
env:
  variables:
      NEXT_PUBLIC_ENV_NODE_ENV: ${process.env.NEXT_PUBLIC_ENV_NODE_ENV}
      COGNITO_CLIENT_ID: ${process.env.COGNITO_CLIENT_ID}
      COGNITO_CLIENT_SECRET: ${process.env.COGNITO_CLIENT_SECRET}
      COGNITO_DOMAIN: ${process.env.COGNITO_DOMAIN}
      AMAZON_SES_SMTP_USER: ${process.env.AMAZON_SES_SMTP_USER}
      AMAZON_SES_SMTP_PASSWORD: ${process.env.AMAZON_SES_SMTP_PASSWORD}
      STRIPE_ENV: ${process.env.STRIPE_ENV}
      NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY: ${process.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY}
      STRIPE_SECRET_KEY: ${process.env.STRIPE_SECRET_KEY}
      STRIPE_WEBHOOK_SECRET: ${process.env.STRIPE_WEBHOOK_SECRET}
backend:
  phases:
    build:
      commands:
        - '# Execute Amplify CLI with the helper script'
        - amplifyPush --simple
frontend:
  phases:
    preBuild:
      commands:
        - yarn install
    build:
      commands:
        - echo "NEXT_PUBLIC_ENV_NODE_ENV=$NEXT_PUBLIC_ENV_NODE_ENV" >> .env.local 
        - echo "COGNITO_CLIENT_ID=$COGNITO_CLIENT_ID" >> .env.local 
        - echo "COGNITO_CLIENT_SECRET=$COGNITO_CLIENT_SECRET" >> .env.local
        - echo "COGNITO_DOMAIN=$COGNITO_DOMAIN" >> .env.local
        - echo "AMAZON_SES_SMTP_USER=$AMAZON_SES_SMTP_USER" >> .env.local
        - echo "AMAZON_SES_SMTP_PASSWORD=$AMAZON_SES_SMTP_PASSWORD" >> .env.local
        - echo "STRIPE_ENV=$STRIPE_ENV" >> .env.local
        - echo "NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=$NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY" >> .env.local
        - echo "STRIPE_SECRET_KEY=$STRIPE_SECRET_KEY" >> .env.local
        - echo "STRIPE_WEBHOOK_SECRET=$STRIPE_WEBHOOK_SECRET" >> .env.local
        - yarn run build
  artifacts:
    baseDirectory: .next
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
